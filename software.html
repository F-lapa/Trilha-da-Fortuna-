
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trilha da Fortuna</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous">
    
    
    <style>

:root {
    --primary-color: #2563eb;
    --secondary-color: #10b981;
    --accent-color: #f59e0b;
    --background-color: #f9fafb;
    --text-color: #1f2937;
    --card-bg: #ffffff;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --border-radius: 0.75rem;
    --transition: all 0.2s ease;
    --gradient: linear-gradient(135deg, #2563eb, #10b981);
}

body.dark-theme {
    --primary-color: #60a5fa;
    --secondary-color: #34d399;
    --accent-color: #facc15;
    --background-color: #111827;
    --text-color: #d1d5db;
    --card-bg: #1f2937;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background: var(--background-color);
    color: var(--text-color);
    line-height: 1.5;
    font-size: 16px;
    transition: var(--transition);
    overflow-x: hidden;
}

/* Header */
header {
    background: var(--card-bg);
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
}

header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary-color);
}

header h1 i {
    color: var(--secondary-color);
}

.header-actions {
    display: flex;
    gap: 1rem;
}

#themeToggle {
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 1.25rem;
    cursor: pointer;
    transition: var(--transition);
}

#themeToggle:hover {
    color: var(--secondary-color);
    transform: rotate(20deg);
}

#logoutLink {
    background: var(--secondary-color);
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
}

#logoutLink:hover {
    background: #0d905d;
    transform: translateY(-2px);
}

/* Container */
.container {
    max-width: 1200px;
    margin: 1.5rem auto;
    padding: 0 1rem;
}

/* Home Section */
.home-section {
    padding: 2rem;
    text-align: center;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
}

.home-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--gradient);
    opacity: 0.05;
    z-index: 0;
}

.home-section h2 {
    font-size: 2rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
}

.home-section p {
    font-size: 1rem;
    max-width: 700px;
    margin: 0 auto 1.5rem;
    color: #6b7280;
    position: relative;
    z-index: 1;
}

.feature-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    position: relative;
    z-index: 1;
}

.feature-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

.feature-card i {
    font-size: 2rem;
    color: var(--secondary-color);
    margin-bottom: 1rem;
}

.feature-card h3 {
    font-size: 1.25rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: var(--primary-color);
}

.feature-card p {
    font-size: 0.9rem;
    color: #6b7280;
}

/* Navigation Tabs */
.nav-tabs {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 0.75rem;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    box-shadow: var(--shadow);
    border: none;
}

.nav-tabs .nav-link {
    color: var(--text-color);
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
    transition: var(--transition);
}

.nav-tabs .nav-link.active {
    background: var(--gradient);
    color: #fff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.nav-tabs .nav-link:hover {
    background: rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

.tab-content {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-top: 1rem;
}

/* Table (Ranking) */
#rankingTable {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 1rem;
    background: var(--card-bg);
    box-shadow: var(--shadow);
    border-radius: var(--border-radius);
    overflow: hidden;
}

#rankingTable th,
#rankingTable td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

#rankingTable th {
    background: var(--gradient);
    font-weight: bold;
    color: #fff;
}

#rankingTable tr:hover {
    background: #f1f1f1;
}

.ranking-position {
    width: 15%;
    text-align: center;
}

.ranking-name {
    width: 40%;
}

.ranking-points {
    width: 20%;
    text-align: center;
}

.ranking-actions {
    width: 25%;
    text-align: center;
}

.btn-add-points,
.btn-remove-user {
    font-size: 0.9rem;
    padding: 6px 12px;
    border-radius: 4px;
    transition: background 0.2s ease;
}

.btn-add-points {
    background: var(--primary-color);
    border: none;
}

.btn-add-points:hover {
    background: #1e3a8a;
}

.btn-remove-user {
    background: #dc3545;
    border: none;
}

.btn-remove-user:hover {
    background: #b02a37;
}

@media (max-width: 768px) {
    #rankingTable {
        font-size: 0.9rem;
    }

    #rankingTable th,
    #rankingTable td {
        padding: 10px 8px;
    }

    .ranking-position {
        width: 20%;
    }

    .ranking-name {
        width: 35%;
    }

    .ranking-points {
        width: 25%;
    }

    .ranking-actions {
        width: 20%;
    }

    .btn-add-points,
    .btn-remove-user {
        font-size: 0.8rem;
        padding: 5px 8px;
    }

    @media (max-width: 576px) {
        #rankingTable thead {
            display: none;
        }

        #rankingTable tr {
            display: block;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }

        #rankingTable td {
            display: block;
            text-align: left;
            padding: 5px 10px;
            border: none;
        }

        #rankingTable td::before {
            content: attr(data-label);
            font-weight: bold;
            display: inline-block;
            width: 100px;
        }

        .ranking-position::before {
            content: "Posição: ";
        }

        .ranking-name::before {
            content: "Nome: ";
        }

        .ranking-points::before {
            content: "Pontos: ";
        }

        .ranking-actions::before {
            content: "Ações: ";
        }

        .ranking-actions {
            text-align: left;
        }

        .btn-add-points,
        .btn-remove-user {
            display: inline-block;
            margin: 5px 5px 0 0;
        }
    }
}

.dark-theme #rankingTable {
    background: #2c2c2c;
    color: #fff;
}

.dark-theme #rankingTable th {
    background: var(--gradient);
    color: #fff;
}

.dark-theme #rankingTable tr:hover {
    background: #3a3a3a;
}

.dark-theme #rankingTable td {
    border-bottom: 1px solid #444;
}

/* List Group */
.list-group-item {
    border-radius: 0.5rem;
    margin-bottom: 0.75rem;
    padding: 1rem;
    background: var(--card-bg);
    transition: var(--transition);
    box-shadow: var(--shadow);
}

.list-group-item:hover {
    background: rgba(0, 0, 0, 0.03);
    transform: translateY(-3px);
}

.list-group-item .btn-sm {
    margin-left: 0.5rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.8rem;
}

.list-group-item .d-flex {
    align-items: center;
}

.list-group-item .badge {
    margin-right: 0.5rem;
}

/* Modal (Incluindo Janelas das Variáveis Globais) */
.modal-content {
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    background: var(--card-bg);
    border: none;
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

.modal-header {
    background: var(--gradient);
    color: #fff;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    padding: 1rem;
}

.modal-body {
    padding: 1.5rem;
    max-height: 70vh;
    overflow-y: auto;
}

.modal-header .btn-close {
    filter: brightness(100%) invert(100%);
}

.variable-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.variable-table th,
.variable-table td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: left;
}

.variable-table th {
    background: var(--gradient);
    color: #fff;
}

.variable-table tr:hover {
    background: #f1f1f1;
}

.dark-theme .variable-table {
    background: #2c2c2c;
}

.dark-theme .variable-table th {
    background: var(--gradient);
}

.dark-theme .variable-table td {
    border-bottom: 1px solid #444;
}

.dark-theme .variable-table tr:hover {
    background: #3a3a3a;
}

/* Forms */
.form-control {
    border-radius: 0.5rem;
    border: 1px solid #d1d5db;
    padding: 0.5rem;
    font-size: 0.95rem;
    transition: var(--transition);
}

.form-control:focus {
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.2);
    outline: none;
}

.btn-primary {
    background: var(--gradient);
    border: none;
    padding: 0.5rem 1.5rem;
    border-radius: 0.5rem;
    color: #fff;
    font-weight: 500;
    transition: var(--transition);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #0d905d, #1e3a8a);
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.btn-danger {
    background: #ef4444;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    color: #fff;
    transition: var(--transition);
}

.btn-danger:hover {
    background: #dc2626;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6b7280;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    color: #fff;
    transition: var(--transition);
}

.btn-secondary:hover {
    background: #4b5563;
    transform: translateY(-2px);
}

/* Messages */
.success-message,
.error-message {
    font-size: 0.85rem;
    margin-top: 0.5rem;
    padding: 0.5rem;
    border-radius: 0.5rem;
    display: none;
}

.success-message {
    background: rgba(16, 185, 129, 0.1);
    color: var(--secondary-color);
}

.error-message {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

.error-message#corretaError {
    display: none;
}

.hidden {
    display: none !important;
}

/* Feed */
.feed-container {
    max-width: 800px;
    margin: 1.5rem auto;
}

.feed-post {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
    transition: var(--transition);
}

.feed-post:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    transform: translateY(-3px);
}

.feed-post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.feed-post-header h5 {
    font-size: 1.1rem;
    font-weight: 500;
    color: var(--primary-color);
}

.feed-post-header small {
    font-size: 0.8rem;
    color: #6b7280;
}

.feed-post-menu {
    position: relative;
}

.feed-post-menu-btn {
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 1.1rem;
    cursor: pointer;
    transition: var(--transition);
}

.feed-post-menu-btn:hover {
    color: var(--secondary-color);
}

.feed-post-menu-content,
.comment-menu-content {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--card-bg);
    box-shadow: var(--shadow);
    border-radius: 0.5rem;
    z-index: 1000;
    min-width: 120px;
}

.feed-post-menu-content.show,
.comment-menu-content.show {
    display: block;
}

.feed-post-menu-content button,
.comment-menu-content button {
    padding: 0.5rem 1rem;
    background: none;
    border: none;
    color: #ef4444;
    cursor: pointer;
    width: 100%;
    text-align: left;
    font-size: 0.9rem;
    transition: var(--transition);
}

.feed-post-menu-content button:hover,
.comment-menu-content button:hover {
    background: rgba(0, 0, 0, 0.05);
}

.feed-post-menu-content button.edit,
.comment-menu-content button.edit {
    color: var(--primary-color);
}

.feed-post-body {
    margin-bottom: 1rem;
}

.feed-post-body p {
    font-size: 0.95rem;
    line-height: 1.6;
}

.feed-actions {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.feed-action-btn {
    background: none;
    border: none;
    color: #555;
    font-size: 1rem;
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: color 0.2s ease, transform 0.1s ease;
    touch-action: manipulation;
}

.feed-action-btn.liked {
    color: #ff0000 !important;
}

.feed-action-btn.liked i.fa-heart {
    color: #ff0000 !important;
    fill: #ff0000 !important;
}

.feed-action-btn:hover {
    color: var(--secondary-color);
    transform: scale(1.1);
}

.comment-section {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.comment-form {
    margin: 10px 0;
    display: flex;
    gap: 10px;
    align-items: center;
}

.comment-form .form-control {
    flex: 1;
    font-size: 0.9rem;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.comment-form .btn-primary {
    padding: 8px 12px;
    font-size: 0.9rem;
}

.comment {
    background: rgba(0, 0, 0, 0.02);
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 0.5rem;
    border-left: 3px solid var(--secondary-color);
    margin-left: 1.5rem;
    transition: var(--transition);
}

.comment:hover {
    background: rgba(0, 0, 0, 0.05);
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.comment-header h6 {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--primary-color);
}

.comment-header small {
    font-size: 0.75rem;
    color: #6b7280;
}

.comment-body {
    font-size: 0.9rem;
    line-height: 1.5;
}

.comment-actions {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.btn-reply {
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 0.9rem;
    padding: 6px 10px;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.1s ease;
    touch-action: manipulation;
}

.btn-reply:hover {
    color: var(--secondary-color);
    transform: scale(1.1);
}

.reply-form {
    margin: 10px 0 10px 1.5rem;
    display: flex;
    gap: 10px;
    align-items: center;
}

.reply-form .form-control {
    flex: 1;
    font-size: 0.9rem;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.reply-form .btn-primary {
    padding: 8px 12px;
    font-size: 0.9rem;
}

.replies {
    margin-left: 2rem;
    margin-top: 0.75rem;
}

.replies .comment {
    background: rgba(0, 0, 0, 0.03);
    padding: 0.75rem;
    border-left: 2px solid var(--accent-color);
}

.edit-form {
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 0.5rem;
}

.edit-form .form-control {
    font-size: 0.9rem;
    padding: 0.5rem;
}

.edit-form .btn-primary,
.edit-form .btn-secondary {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

/* Feed Form */
#feedFormContainer {
    position: relative;
    z-index: 10;
}

#feedMessage {
    pointer-events: auto !important;
    user-select: auto !important;
    opacity: 1 !important;
    resize: vertical;
    min-height: 80px;
}

#feedFormContainer.hidden {
    display: none !important;
}

#feedForm {
    pointer-events: auto !important;
}

/* Admin Variables Section */
.admin-variables {
    margin-top: 2rem;
}

.admin-variables h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.admin-variables .btn-variable {
    background: var(--gradient);
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    margin: 0.5rem;
    font-size: 0.9rem;
    transition: var(--transition);
}

.admin-variables .btn-variable:hover {
    background: linear-gradient(135deg, #0d905d, #1e3a8a);
    transform: translateY(-2px);
}

/* Footer */
footer {
    background: var(--gradient);
    color: #fff;
    text-align: center;
    padding: 1.5rem;
    margin-top: 2rem;
    font-size: 0.9rem;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.15);
}

/* Responsive Adjustments */
@media (max-width: 992px) {
    .container {
        padding: 0 0.75rem;
    }

    .home-section {
        padding: 1.5rem;
    }

    .feature-cards {
        grid-template-columns: 1fr;
    }

    .nav-tabs {
        flex-direction: column;
        gap: 0.5rem;
    }

    .nav-tabs .nav-link {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 768px) {
    header {
        flex-direction: column;
        align-items: flex-start;
        padding: 0.75rem;
    }

    header h1 {
        font-size: 1.25rem;
    }

    .header-actions {
        width: 100%;
        justify-content: space-between;
    }

    .modal-dialog {
        margin: 0.5rem;
    }

    .modal-body {
        padding: 1rem;
    }

    .feed-post {
        padding: 1rem;
    }

    .comment {
        margin-left: 1rem;
    }

    .replies {
        margin-left: 1rem;
    }

    .feed-action-btn {
        font-size: 0.9rem;
        padding: 6px 10px;
    }

    .btn-reply {
        font-size: 0.8rem;
        padding: 5px 8px;
    }

    .comment-form .form-control,
    .reply-form .form-control {
        font-size: 0.8rem;
        padding: 6px;
    }

    .comment-form .btn-primary,
    .reply-form .btn-primary {
        font-size: 0.8rem;
        padding: 6px 10px;
    }
}

@media (max-width: 576px) {
    body {
        font-size: 14px;
    }

    .home-section h2 {
        font-size: 1.5rem;
    }

    .btn-primary,
    .btn-danger,
    .btn-secondary {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
    }

    .feed-post-header h5 {
        font-size: 1rem;
    }

    .feed-action-btn {
        font-size: 0.85rem;
    }

    .comment {
        padding: 0.75rem;
    }

    .form-control {
        font-size: 0.85rem;
        padding: 0.5rem;
    }

    .admin-variables .btn-variable {
        width: 100%;
        margin: 0.5rem 0;
    }
}

    </style>
</head>
<body>
    <header id="header">
        <h1><i class="fas fa-coins"></i> Trilha da Fortuna</h1>
        <div class="header-actions">
            <button id="themeToggle" title="Alternar Tema" aria-label="Alternar tema"><i class="fas fa-moon"></i></button>
            <a href="index.html" id="logoutLink" aria-label="Sair">Sair</a>
        </div>
    </header>

    <div class="container">
        <section class="content-section" id="contentSection">
            <ul class="nav nav-tabs mb-0" id="navTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="homeTab" data-bs-toggle="tab" href="#home" role="tab" aria-selected="true"><i class="fas fa-home"></i> Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="provasTab" data-bs-toggle="tab" href="#provas" role="tab" aria-selected="false"><i class="fas fa-file-alt"></i> Provas</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="rankingTab" data-bs-toggle="tab" href="#ranking" role="tab" aria-selected="false"><i class="fas fa-trophy"></i> Ranking</a>
                </li>
                <li class="nav-item" id="comprovanteTabItem">
                    <a class="nav-link" id="comprovanteTabLink" data-bs-toggle="tab" href="#comprovante" role="tab" aria-selected="false"><i class="fas fa-file-invoice-dollar"></i> Enviar Comprovante</a>
                </li>
                <li class="nav-item hidden" id="adminTabItem">
                    <a class="nav-link" id="adminTabLink" data-bs-toggle="tab" href="#administrador" role="tab" aria-selected="false"><i class="fas fa-user-shield"></i> Administrador</a>
                </li>
                <li class="nav-item hidden" id="investimentosTabItem">
                    <a class="nav-link" id="investimentosTabLink" data-bs-toggle="tab" href="#investimentos" role="tab" aria-selected="false"><i class="fas fa-chart-line"></i> Investimentos</a>
                </li>
            </ul>

            <div class="tab-content">
                <section class="tab-pane fade show active" id="home" role="tabpanel">
                    <div class="home-section">
                        <h2>Bem-vindo à Trilha da Fortuna!</h2>
                        <p>Explore sua jornada financeira com aprendizado, competição e recompensas incríveis.</p>
                        <div class="feature-cards">
                            <article class="feature-card">
                                <i class="fas fa-file-alt"></i>
                                <h3>Provas</h3>
                                <p>Teste seus conhecimentos financeiros e acumule pontos.</p>
                            </article>
                            <article class="feature-card">
                                <i class="fas fa-trophy"></i>
                                <h3>Ranking</h3>
                                <p>Compare sua pontuação e conquiste o topo do ranking.</p>
                            </article>
                            <article class="feature-card">
                                <i class="fas fa-file-invoice-dollar"></i>
                                <h3>Comprovantes</h3>
                                <p>Envie comprovantes de investimentos e acompanhe seu progresso.</p>
                            </article>
                        </div>
                        <div id="feedSection" class="mt-5">
                            <h3>Feed de Recados</h3>
                            <div id="feedFormContainer" class="hidden">
                                <form id="feedForm">
                                    <div class="mb-3">
                                        <textarea id="feedMessage" class="form-control" placeholder="Escreva um recado" required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Postar</button>
                                    <div id="feedSuccess" class="alert alert-success hidden">Recado postado com sucesso!</div>
                                    <div id="feedError" class="alert alert-danger hidden">Por favor, escreva uma mensagem.</div>
                                </form>
                            </div>
                            <div id="feedContainer"></div>
                        </div>
                    </div>
                </section>

                <section class="tab-pane fade" id="provas" role="tabpanel">
                    <h2 class="mb-4">Provas Disponíveis</h2>
                    <ul class="list-group" id="listaProvas"></ul>
                </section>

                <section class="tab-pane fade" id="ranking" role="tabpanel">
                    <h2 class="mb-4">Ranking de Usuários</h2>
                    <table class="table table-striped">
                        <thead id="rankingHead"></thead>
                        <tbody id="rankingBody"></tbody>
                    </table>
                </section>

                <section class="tab-pane fade" id="comprovante" role="tabpanel">
                    <h2 class="mb-4">Enviar Comprovante</h2>
                    <div class="card">
                        <div class="card-body">
                            <form id="comprovanteForm">
                                <div class="mb-3">
                                    <label for="comprovanteArquivo" class="form-label">Selecione o comprovante</label>
                                    <input type="file" id="comprovanteArquivo" class="form-control" accept=".jpg,.jpeg,.png,.pdf" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Enviar</button>
                                <div class="success-message" id="comprovanteSuccess">Comprovante enviado!</div>
                            </form>
                        </div>
                    </div>
                </section>

                <section class="tab-pane fade" id="administrador" role="tabpanel">
                    <h2 class="mb-4">Gerenciamento</h2>
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5>Criar Prova</h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#novaProvaModal">Criar Prova</button>
                        </div>
                    </div>
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5>Provas Criadas</h5>
                            <ul class="list-group" id="listaProvasAdmin"></ul>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <h5>Cadastrar Usuário</h5>
                            <form id="novoUsuarioForm">
                                <div class="mb-3">
                                    <label for="novoUsername" class="form-label">Nome de usuário</label>
                                    <input type="text" id="novoUsername" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="novoPassword" class="form-label">Senha</label>
                                    <input type="password" id="novoPassword" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="nomeUsuario" class="form-label">Nome</label>
                                    <input type="text" id="nomeUsuario" class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Cadastrar</button>
                            </form>
                        </div>
                    </div>
                </section>

                <section class="tab-pane fade" id="investimentos" role="tabpanel">
                    <h2 class="mb-4">Investimentos Recebidos</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Usuário</th>
                                <th>Data de Envio</th>
                                <th>Status</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="investimentosBody"></tbody>
                    </table>
                </section>
            </div>
        </section>
    </div>

    <div class="modal fade" id="novaProvaModal" tabindex="-1" aria-labelledby="novaProvaModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="novaProvaModalLabel">Criar Nova Prova</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="novaProvaForm">
                        <div class="mb-3">
                            <label for="tituloProva" class="form-label">Título da Prova</label>
                            <input type="text" id="tituloProva" class="form-control" required>
                        </div>
                        <div id="perguntasLista" class="mb-3"></div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#novaPerguntaModal">Adicionar Pergunta</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="novaPerguntaModal" tabindex="-1" aria-labelledby="novaPerguntaModalLabel">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="novaPerguntaModalLabel">Pergunta 1</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="novaPerguntaForm">
                        <div class="mb-3">
                            <label for="perguntaTexto" class="form-label">Pergunta</label>
                            <textarea class="form-control" id="perguntaTexto" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="opcaoA" class="form-label">Resposta A</label>
                            <input type="text" class="form-control" id="opcaoA" required>
                        </div>
                        <div class="mb-3">
                            <label for="opcaoB" class="form-label">Resposta B</label>
                            <input type="text" class="form-control" id="opcaoB" required>
                        </div>
                        <div class="mb-3">
                            <label for="opcaoC" class="form-label">Resposta C</label>
                            <input type="text" class="form-control" id="opcaoC" required>
                        </div>
                        <div class="mb-3">
                            <label for="opcaoD" class="form-label">Resposta D</label>
                            <input type="text" class="form-control" id="opcaoD" required>
                        </div>
                        <div class="mb-3">
                            <label for="correta" class="form-label">Resposta correta (a, b, c, d)</label>
                            <input type="text" class="form-control" id="correta" maxlength="1" required>
                            <div class="error-message" id="corretaError">Apenas as letras a, b, c ou d são permitidas.</div>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Próxima Pergunta</button>
                            <button type="button" id="btnEnviarProva" class="btn btn-success hidden" onclick="enviarProva()">Enviar Prova</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="provaModal" tabindex="-1" aria-labelledby="provaModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="provaModalLabel">Prova</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="provaForm">
                        <div id="perguntaContainer"></div>
                        <div class="error-message" id="respostaError" style="display: none;">Por favor, selecione uma resposta.</div>
                        <div class="d-flex justify-content-between mt-3">
                            <button type="button" id="btnAnterior" class="btn btn-secondary hidden">Pergunta Anterior</button>
                            <button type="button" id="btnProxima" class="btn btn-primary">Próxima Pergunta</button>
                            <button type="button" id="btnEnviar" class="btn btn-primary hidden">Enviar Prova</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmacaoEnvioModal" tabindex="-1" aria-labelledby="confirmacaoEnvioModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmacaoEnvioModalLabel">Confirmar Envio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja enviar a prova? Você não poderá alterar suas respostas após o envio.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmarEnvioBtn">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmacaoExclusaoProvaModal" tabindex="-1" aria-labelledby="confirmacaoExclusaoProvaModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmacaoExclusaoProvaModalLabel">Confirmação de Exclusão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir a prova <strong id="tituloProvaExclusao"></strong>?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmarExclusaoProvaBtn">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmacaoEnvioProvaModal" tabindex="-1" aria-labelledby="confirmacaoEnvioProvaModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmacaoEnvioProvaModalLabel">Confirmar Envio da Prova</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja enviar a prova <strong id="tituloProvaEnvio"></strong> para a aba de provas dos usuários?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmarEnvioProvaBtn">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="resultadoModal" tabindex="-1" aria-labelledby="resultadoModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultadoModalLabel">Resultado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p id="resultadoTexto"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="sucessoModal" tabindex="-1" aria-labelledby="sucessoModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sucessoModalLabel">Sucesso</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p id="sucessoTexto">Operação realizada com sucesso!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="sucessoOkButton">OK</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="comprovanteModal" tabindex="-1" aria-labelledby="comprovanteModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="comprovanteModalLabel">Visualizar Comprovante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p id="comprovanteInfo"></p>
                    <div id="comprovanteVisualizacao"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="verificarComprovanteBtn">OK</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmacaoExclusaoModal" tabindex="-1" aria-labelledby="confirmacaoExclusaoModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmacaoExclusaoModalLabel">Confirmação de Exclusão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja remover o usuário <strong id="nomeUsuarioExclusao"></strong>?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmarExclusaoBtn">Remover</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="adicionarPontuacaoModal" tabindex="-1" aria-labelledby="adicionarPontuacaoModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adicionarPontuacaoModalLabel">Adicionar Pontuação</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="adicionarPontuacaoForm">
                        <div class="mb-3">
                            <label for="pontosInput" class="form-label">Pontos a adicionar</label>
                            <input type="number" id="pontosInput" class="form-control" min="0" required>
                            <div class="error-message" id="pontosError" style="display: none;">Por favor, insira um valor numérico válido.</div>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Adicionar</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer id="footer">
        <p>© 2025 Trilha da Fortuna. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   
 <script>

let usuarios = [];
let provas = [];
let comprovantes = [];
let respostas = {};
let feeds = [];
let perguntasTemp = [];

const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
if (!usuarioLogado) {
    window.location.href = 'index.html';
}

function carregarDados() {
    const usuariosSalvos = localStorage.getItem('usuarios');
    const provasSalvas = localStorage.getItem('provas');
    const comprovantesSalvos = localStorage.getItem('comprovantes');
    const respostasSalvas = localStorage.getItem('respostas');
    const feedsSalvos = localStorage.getItem('feeds');

    let usuarios = usuariosSalvos ? JSON.parse(usuariosSalvos) : [
        { username: "admin123", password: "admin123", nome: "Administrador", isAdmin: true, pontos: 0 },
        { username: "user1", password: "user123", nome: "João Silva", isAdmin: false, pontos: 100 },
        { username: "user2", password: "user123", nome: "Maria Oliveira", isAdmin: false, pontos: 50 }
    ];

    const adminUser = usuarios.find(u => u.username === "admin123");
    if (adminUser) {
        adminUser.isAdmin = true;
    } else {
        usuarios.push({ username: "admin123", password: "admin123", nome: "Administrador", isAdmin: true, pontos: 0 });
    }

    let provas = provasSalvas ? JSON.parse(provasSalvas) : [];
    provas = provas.map(p => ({ ...p, publicada: p.publicada !== undefined ? p.publicada : false }));

    let feeds = feedsSalvos ? JSON.parse(feedsSalvos) : [];
    feeds = feeds.map(f => ({
        ...f,
        curtidas: Array.isArray(f.curtidas) ? f.curtidas : [],
        comentarios: Array.isArray(f.comentarios) ? f.comentarios.map(c => ({
            ...c,
            autor: c.autor || '[Desconhecido]',
            mensagem: c.mensagem || '',
            data: c.data || new Date().toLocaleString('pt-BR'),
            curtidas: Array.isArray(c.curtidas) ? c.curtidas : [],
            respostas: Array.isArray(c.respostas) ? c.respostas.map(r => ({
                ...r,
                autor: r.autor || '[Desconhecido]',
                mensagem: r.mensagem || '',
                data: r.data || new Date().toLocaleString('pt-BR')
            })) : []
        })) : []
    }));

    return {
        usuarios,
        provas,
        comprovantes: comprovantesSalvos ? JSON.parse(comprovantesSalvos) : [],
        respostas: respostasSalvas ? JSON.parse(respostasSalvas) : {},
        feeds
    };
}

function salvarDados() {
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    localStorage.setItem('provas', JSON.stringify(provas));
    localStorage.setItem('comprovantes', JSON.stringify(comprovantes));
    localStorage.setItem('respostas', JSON.stringify(respostas));
    localStorage.setItem('feeds', JSON.stringify(feeds));
}

document.addEventListener('DOMContentLoaded', () => {
    console.log('17. DOMContentLoaded. Usuario logado:', usuarioLogado);

    const dados = carregarDados();
    usuarios = dados.usuarios;
    provas = dados.provas;
    comprovantes = dados.comprovantes;
    respostas = dados.respostas;
    feeds = dados.feeds;

    if (usuarioLogado.username === 'admin123' && usuarioLogado.isAdmin !== true) {
        usuarioLogado.isAdmin = true;
        localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
        console.log('18. Corrigido: isAdmin definido como true em DOMContentLoaded.');
    }

    ajustarAbas();
    atualizarProvas();
    atualizarProvasAdmin();
    atualizarRanking();
    atualizarInvestimentos();
    configurarFeed();
    if (usuarioLogado.isAdmin) {
        configurarAdminVariables();
    }

    document.getElementById('correta').addEventListener('input', (e) => {
        const input = e.target;
        const value = input.value.toLowerCase();
        const errorMessage = document.getElementById('corretaError');
        if (value && !['a', 'b', 'c', 'd'].includes(value)) {
            input.value = '';
            errorMessage.style.display = 'block';
            setTimeout(() => errorMessage.style.display = 'none', 3000);
        } else {
            errorMessage.style.display = 'none';
        }
    });

    document.addEventListener('click', (e) => {
        const menus = document.querySelectorAll('.feed-post-menu-content.show, .comment-menu-content.show');
        menus.forEach(menu => {
            const menuBtn = menu.previousElementSibling;
            if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
                menu.classList.remove('show');
            }
        });
    });
});

function ajustarAbas() {
    console.log('14. Ajustando abas. É admin?', usuarioLogado?.isAdmin);

    const comprovanteTabItem = document.getElementById('comprovanteTabItem');
    const adminTabItem = document.getElementById('adminTabItem');
    const investimentosTabItem = document.getElementById('investimentosTabItem');
    const feedFormContainer = document.getElementById('feedFormContainer');

    if (usuarioLogado.isAdmin) {
        comprovanteTabItem.classList.add('hidden');
        adminTabItem.classList.remove('hidden');
        investimentosTabItem.classList.remove('hidden');
        if (feedFormContainer) {
            feedFormContainer.classList.remove('hidden');
            console.log('15. Formulário de feed exibido em ajustarAbas.');
        }
    } else {
        comprovanteTabItem.classList.remove('hidden');
        adminTabItem.classList.add('hidden');
        investimentosTabItem.classList.add('hidden');
        if (feedFormContainer) {
            feedFormContainer.classList.add('hidden');
            console.log('16. Formulário de feed oculto em ajustarAbas.');
        }
    }
}

function configurarAdminVariables() {
    const adminTabContent = document.getElementById('admin');
    if (!adminTabContent) return;

    const variablesSection = document.createElement('div');
    variablesSection.className = 'admin-variables';
    variablesSection.innerHTML = `
        <h3>Gerenciar Dados Globais</h3>
        <div>
            <button class="btn-variable" onclick="mostrarUsuarios()">Ver Usuários</button>
            <button class="btn-variable" onclick="mostrarProvas()">Ver Provas</button>
            <button class="btn-variable" onclick="mostrarComprovantes()">Ver Comprovantes</button>
            <button class="btn-variable" onclick="mostrarRespostas()">Ver Respostas</button>
            <button class="btn-variable" onclick="mostrarFeeds()">Ver Feeds</button>
            <button class="btn-variable" onclick="mostrarPerguntasTemp()">Ver Perguntas Temporárias</button>
        </div>
    `;
    adminTabContent.appendChild(variablesSection);
}

function mostrarUsuarios() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'usuariosModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Usuários</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="variable-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Nome</th>
                                <th>Admin</th>
                                <th>Pontos</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${usuarios.map(u => `
                                <tr>
                                    <td>${sanitizeInput(u.username)}</td>
                                    <td>${sanitizeInput(u.nome)}</td>
                                    <td>${u.isAdmin ? 'Sim' : 'Não'}</td>
                                    <td>${u.pontos}</td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" onclick="confirmarExclusaoUsuario('${sanitizeInput(u.username)}')">Remover</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    new bootstrap.Modal(modal).show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

function mostrarProvas() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'provasModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Provas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="variable-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Título</th>
                                <th>Publicada</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${provas.map(p => `
                                <tr>
                                    <td>${p.id}</td>
                                    <td>${sanitizeInput(p.titulo)}</td>
                                    <td>${p.publicada ? 'Sim' : 'Não'}</td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" onclick="confirmarExclusaoProva(${p.id}, '${sanitizeInput(p.titulo)}')">Excluir</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    new bootstrap.Modal(modal).show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

function mostrarComprovantes() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'comprovantesModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Comprovantes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="variable-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuário</th>
                                <th>Data</th>
                                <th>Verificado</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${comprovantes.map(c => `
                                <tr>
                                    <td>${c.id}</td>
                                    <td>${sanitizeInput(c.nome)}</td>
                                    <td>${sanitizeInput(c.data)}</td>
                                    <td>${c.verificado ? 'Sim' : 'Não'}</td>
                                    <td>
                                        <button class="btn btn-primary btn-sm me-1" onclick="visualizarComprovante(${c.id})">Visualizar</button>
                                        <button class="btn btn-danger btn-sm" onclick="excluirComprovante(${c.id})">Excluir</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    new bootstrap.Modal(modal).show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

function excluirComprovante(id) {
    comprovantes = comprovantes.filter(c => c.id !== id);
    salvarDados();
    atualizarInvestimentos();
    bootstrap.Modal.getInstance(document.getElementById('comprovantesModal')).hide();
    document.getElementById('sucessoTexto').textContent = 'Comprovante excluído!';
    new bootstrap.Modal(document.getElementById('sucessoModal')).show();
}

function mostrarRespostas() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'respostasModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Respostas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="variable-table">
                        <thead>
                            <tr>
                                <th>Usuário</th>
                                <th>Prova ID</th>
                                <th>Pontuação</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.keys(respostas).flatMap(username => 
                                Object.keys(respostas[username]).map(provaId => `
                                    <tr>
                                        <td>${sanitizeInput(username)}</td>
                                        <td>${provaId}</td>
                                        <td>${respostas[username][provaId].pontuacao}</td>
                                    </tr>
                                `)
                            ).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    new bootstrap.Modal(modal).show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

function mostrarFeeds() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'feedsModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Feeds</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="variable-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Autor</th>
                                <th>Mensagem</th>
                                <th>Data</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${feeds.map(f => `
                                <tr>
                                    <td>${f.id}</td>
                                    <td>${sanitizeInput(f.autor)}</td>
                                    <td>${sanitizeInput(f.mensagem.substring(0, 50) + (f.mensagem.length > 50 ? '...' : ''))}</td>
                                    <td>${sanitizeInput(f.data)}</td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" onclick="excluirFeed(${f.id})">Excluir</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    new bootstrap.Modal(modal).show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

function mostrarPerguntasTemp() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'perguntasTempModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Perguntas Temporárias</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="variable-table">
                        <thead>
                            <tr>
                                <th>Texto</th>
                                <th>Resposta Correta</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${perguntasTemp.map(p => `
                                <tr>
                                    <td>${sanitizeInput(p.texto.substring(0, 50) + (p.texto.length > 50 ? '...' : ''))}</td>
                                    <td>${sanitizeInput(p.correta.toUpperCase())}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    new bootstrap.Modal(modal).show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

document.getElementById('themeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark-theme');
    const isDark = document.body.classList.contains('dark-theme');
    document.getElementById('themeToggle').innerHTML = `<i class="fas fa-${isDark ? 'sun' : 'moon'}"></i>`;
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
});

if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-theme');
    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
}

document.getElementById('novaPerguntaForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const texto = document.getElementById('perguntaTexto').value.trim();
    const opcaoA = document.getElementById('opcaoA').value.trim();
    const opcaoB = document.getElementById('opcaoB').value.trim();
    const opcaoC = document.getElementById('opcaoC').value.trim();
    const opcaoD = document.getElementById('opcaoD').value.trim();
    const correta = document.getElementById('correta').value.trim().toLowerCase();

    if (!texto || !opcaoA || !opcaoB || !opcaoC || !opcaoD || !['a', 'b', 'c', 'd'].includes(correta)) {
        alert('Por favor, preencha todos os campos corretamente. A resposta correta deve ser a, b, c ou d.');
        return;
    }

    perguntasTemp.push({
        texto,
        opcoes: { a: opcaoA, b: opcaoB, c: opcaoC, d: opcaoD },
        correta
    });

    atualizarListaPerguntas();
    document.getElementById('novaPerguntaForm').reset();
    document.getElementById('novaPerguntaModalLabel').textContent = `Pergunta ${perguntasTemp.length + 1}`;
    
    const btnEnviarProva = document.getElementById('btnEnviarProva');
    btnEnviarProva.classList.toggle('hidden', perguntasTemp.length < 1);
});

function enviarProva() {
    const titulo = document.getElementById('tituloProva').value.trim();
    if (!titulo || perguntasTemp.length === 0) {
        alert('Por favor, insira um título e pelo menos uma pergunta.');
        return;
    }

    provas.push({
        id: provas.length + 1,
        titulo,
        perguntas: perguntasTemp,
        publicada: false
    });

    salvarDados();
    perguntasTemp = [];
    document.getElementById('novaProvaForm').reset();
    atualizarListaPerguntas();
    const perguntaModal = bootstrap.Modal.getInstance(document.getElementById('novaPerguntaModal'));
    const provaModal = bootstrap.Modal.getInstance(document.getElementById('novaProvaModal'));
    perguntaModal.hide();
    provaModal.hide();
    document.getElementById('sucessoTexto').textContent = 'Prova criada com sucesso!';
    new bootstrap.Modal(document.getElementById('sucessoModal')).show();
    atualizarProvas();
    atualizarProvasAdmin();
}

function atualizarProvasAdmin() {
    const listaProvasAdmin = document.getElementById('listaProvasAdmin');
    listaProvasAdmin.innerHTML = '';
    provas.forEach(prova => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `
            <span>${sanitizeInput(prova.titulo)} ${prova.publicada ? '<span class="badge bg-success">Publicada</span>' : '<span class="badge bg-warning">Não publicada</span>'}</span>
            <div>
                ${!prova.publicada ? `<button class="btn btn-primary btn-sm" onclick="confirmarEnvioProva(${prova.id}, '${sanitizeInput(prova.titulo)}')">Enviar</button>` : ''}
                <button class="btn btn-danger btn-sm" onclick="confirmarExclusaoProva(${prova.id}, '${sanitizeInput(prova.titulo)}')">Excluir</button>
            </div>
        `;
        listaProvasAdmin.appendChild(li);
    });
}

function atualizarListaPerguntas() {
    const lista = document.getElementById('perguntasLista');
    lista.innerHTML = perguntasTemp.length ? `
        <h6>Perguntas Adicionadas:</h6>
        <ul class="list-group">
            ${perguntasTemp.map((p, i) => `
                <li class="list-group-item">Pergunta ${i + 1}: ${sanitizeInput(p.texto)}</li>
            `).join('')}
        </ul>
    ` : '<p class="text-muted">Nenhuma pergunta adicionada.</p>';
}

document.getElementById('novaProvaModal').addEventListener('show.bs.modal', () => {
    perguntasTemp = [];
    document.getElementById('novaPerguntaModalLabel').textContent = 'Pergunta 1';
    atualizarListaPerguntas();
    document.getElementById('novaProvaForm').reset();
    const btnEnviarProva = document.getElementById('btnEnviarProva');
    if (btnEnviarProva) {
        btnEnviarProva.classList.add('hidden');
    }
});

document.getElementById('novaProvaForm').addEventListener('submit', (e) => {
    e.preventDefault();
    alert('Por favor, adicione perguntas e envie a prova pelo modal de perguntas.');
});

document.getElementById('sucessoOkButton').addEventListener('click', () => {
    bootstrap.Modal.getInstance(document.getElementById('sucessoModal')).hide();
});

function atualizarProvas() {
    const listaProvas = document.getElementById('listaProvas');
    listaProvas.innerHTML = '';
    provas.filter(prova => prova.publicada).forEach(prova => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        let nota = '';
        let isConcluida = false;
        if (!usuarioLogado.isAdmin && respostas[usuarioLogado.username]?.[prova.id]) {
            nota = `<span class="badge bg-success">Nota: ${respostas[usuarioLogado.username][prova.id].pontuacao}</span>`;
            isConcluida = true;
        }
        li.innerHTML = `
            <span>${sanitizeInput(prova.titulo)}</span>
            <div>
                ${nota}
                ${usuarioLogado.isAdmin ? `<button class="btn btn-danger btn-sm ms-2" onclick="confirmarExclusaoProva(${prova.id}, '${sanitizeInput(prova.titulo)}')">Excluir</button>` : ''}
            </div>
        `;
        if (!isConcluida && !usuarioLogado.isAdmin) {
            li.style.cursor = 'pointer';
            li.addEventListener('click', () => abrirProva(prova));
        }
        listaProvas.appendChild(li);
    });
}

function confirmarEnvioProva(provaId, titulo) {
    document.getElementById('tituloProvaEnvio').textContent = sanitizeInput(titulo);
    const modal = new bootstrap.Modal(document.getElementById('confirmacaoEnvioProvaModal'));
    document.getElementById('confirmarEnvioProvaBtn').onclick = () => {
        const prova = provas.find(p => p.id === provaId);
        if (prova) {
            prova.publicada = true;
            salvarDados();
            atualizarProvas();
            atualizarProvasAdmin();
            modal.hide();
            document.getElementById('sucessoTexto').textContent = 'Prova enviada para os usuários!';
            new bootstrap.Modal(document.getElementById('sucessoModal')).show();
        }
    };
    modal.show();
}

function confirmarExclusaoProva(provaId, titulo) {
    document.getElementById('tituloProvaExclusao').textContent = sanitizeInput(titulo);
    const modal = new bootstrap.Modal(document.getElementById('confirmacaoExclusaoProvaModal'));
    document.getElementById('confirmarExclusaoProvaBtn').onclick = () => {
        provas = provas.filter(p => p.id !== provaId);
        Object.keys(respostas).forEach(username => {
            delete respostas[username][provaId];
        });
        salvarDados();
        atualizarProvas();
        atualizarProvasAdmin();
        modal.hide();
        document.getElementById('sucessoTexto').textContent = 'Prova excluída!';
        new bootstrap.Modal(document.getElementById('sucessoModal')).show();
    };
    modal.show();
}

function abrirProva(prova) {
    if (usuarioLogado.isAdmin || respostas[usuarioLogado.username]?.[prova.id]) return;
    const modal = new bootstrap.Modal(document.getElementById('provaModal'));
    document.getElementById('provaModalLabel').textContent = sanitizeInput(prova.titulo);
    const container = document.getElementById('perguntaContainer');
    const btnAnterior = document.getElementById('btnAnterior');
    const btnProxima = document.getElementById('btnProxima');
    const btnEnviar = document.getElementById('btnEnviar');
    const errorMessage = document.getElementById('respostaError');
    let currentIndex = 0;
    const respostasTemp = {};

    function renderizarPergunta(index) {
        const p = prova.perguntas[index];
        container.innerHTML = `
            <div class="question">
                <p>Pergunta ${index + 1} de ${prova.perguntas.length}: ${sanitizeInput(p.texto)}</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q${index}" value="a" id="q${index}a" ${respostasTemp[index] === 'a' ? 'checked' : ''}>
                    <label class="form-check-label" for="q${index}a">${sanitizeInput(p.opcoes.a)}</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q${index}" value="b" id="q${index}b" ${respostasTemp[index] === 'b' ? 'checked' : ''}>
                    <label class="form-check-label" for="q${index}b">${sanitizeInput(p.opcoes.b)}</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q${index}" value="c" id="q${index}c" ${respostasTemp[index] === 'c' ? 'checked' : ''}>
                    <label class="form-check-label" for="q${index}c">${sanitizeInput(p.opcoes.c)}</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q${index}" value="d" id="q${index}d" ${respostasTemp[index] === 'd' ? 'checked' : ''}>
                    <label class="form-check-label" for="q${index}d">${sanitizeInput(p.opcoes.d)}</label>
                </div>
            </div>
        `;
        btnAnterior.classList.toggle('hidden', index === 0);
        btnProxima.classList.toggle('hidden', index === prova.perguntas.length - 1);
        btnEnviar.classList.toggle('hidden', index !== prova.perguntas.length - 1);
        errorMessage.style.display = 'none';

        document.querySelectorAll(`input[name="q${index}"]`).forEach(input => {
            input.addEventListener('change', () => {
                respostasTemp[index] = input.value;
            });
        });
    }

    function validarResposta(index) {
        const resposta = document.querySelector(`input[name="q${index}"]:checked`);
        if (!resposta) {
            errorMessage.style.display = 'block';
            setTimeout(() => errorMessage.style.display = 'none', 3000);
            return false;
        }
        respostasTemp[index] = resposta.value;
        return true;
    }

    renderizarPergunta(currentIndex);

    btnProxima.addEventListener('click', () => {
        if (validarResposta(currentIndex)) {
            currentIndex++;
            renderizarPergunta(currentIndex);
        }
    });

    btnAnterior.addEventListener('click', () => {
        if (validarResposta(currentIndex)) {
            currentIndex--;
            renderizarPergunta(currentIndex);
        }
    });

    btnEnviar.addEventListener('click', () => {
        if (validarResposta(currentIndex)) {
            const confirmModal = new bootstrap.Modal(document.getElementById('confirmacaoEnvioModal'));
            confirmModal.show();
            document.getElementById('confirmarEnvioBtn').onclick = () => {
                let pontuacao = 0;
                prova.perguntas.forEach((p, i) => {
                    if (respostasTemp[i] === p.correta) pontuacao += 50;
                });
                if (!respostas[usuarioLogado.username]) respostas[usuarioLogado.username] = {};
                respostas[usuarioLogado.username][prova.id] = { pontuacao, respostas: respostasTemp };
                const usuario = usuarios.find(u => u.username === usuarioLogado.username);
                usuario.pontos += pontuacao;
                salvarDados();
                confirmModal.hide();
                modal.hide();
                document.getElementById('resultadoTexto').textContent = `Pontuação: ${pontuacao} pontos!`;
                new bootstrap.Modal(document.getElementById('resultadoModal')).show();
                atualizarProvas();
                atualizarRanking();
            };
        }
    });

    modal.show();
}

function atualizarRanking() {
    const rankingHead = document.getElementById('rankingHead');
    const rankingBody = document.getElementById('rankingBody');

    rankingHead.innerHTML = `
        <tr>
            <th class="ranking-position">Posição</th>
            <th class="ranking-name">Nome</th>
            <th class="ranking-points">Pontos</th>
            ${usuarioLogado.isAdmin ? '<th class="ranking-actions">Ações</th>' : ''}
        </tr>
    `;

    rankingBody.innerHTML = '';
    const ordenados = [...usuarios].sort((a, b) => b.pontos - a.pontos);
    ordenados.forEach((u, i) => {
        if (!u.isAdmin) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="ranking-position" data-label="Posição">${i + 1}</td>
                <td class="ranking-name" data-label="Nome">${sanitizeInput(u.nome)}</td>
                <td class="ranking-points" data-label="Pontos">${u.pontos}</td>
                ${usuarioLogado.isAdmin ? `
                    <td class="ranking-actions" data-label="Ações">
                        <button class="btn btn-primary btn-sm btn-add-points me-1" onclick="abrirModalPontuacao('${sanitizeInput(u.username)}')">Adicionar</button>
                        <button class="btn btn-danger btn-sm btn-remove-user" onclick="confirmarExclusaoUsuario('${sanitizeInput(u.username)}')">Remover</button>
                    </td>
                ` : ''}
            `;
            rankingBody.appendChild(row);
        }
    });
}

function confirmarExclusaoUsuario(username) {
    const usuario = usuarios.find(u => u.username === username);
    document.getElementById('nomeUsuarioExclusao').textContent = sanitizeInput(usuario.nome);
    const modal = new bootstrap.Modal(document.getElementById('confirmacaoExclusaoModal'));
    document.getElementById('confirmarExclusaoBtn').onclick = () => {
        usuarios = usuarios.filter(u => u.username !== username);
        delete respostas[username];
        comprovantes = comprovantes.filter(c => c.username !== username);
        feeds = feeds.map(f => ({
            ...f,
            curtidas: f.curtidas.filter(u => u !== username),
            comentarios: f.comentarios.map(c => ({
                ...c,
                autor: c.autor === username ? '[Removido]' : c.autor,
                curtidas: c.curtidas.filter(u => u !== username),
                respostas: c.respostas.map(r => ({
                    ...r,
                    autor: r.autor === username ? '[Removido]' : r.autor
                }))
            }))
        }));
        salvarDados();
        atualizarRanking();
        atualizarInvestimentos();
        atualizarFeed();
        modal.hide();
        document.getElementById('sucessoTexto').textContent = 'Usuário removido!';
        new bootstrap.Modal(document.getElementById('sucessoModal')).show();
    };
    modal.show();
}

document.getElementById('novoUsuarioForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const username = document.getElementById('novoUsername').value.trim();
    const password = document.getElementById('novoPassword').value.trim();
    const nome = document.getElementById('nomeUsuario').value.trim();
    if (usuarios.find(u => u.username === username)) return;
    usuarios.push({ username, password, nome, isAdmin: false, pontos: 0 });
    salvarDados();
    document.getElementById('novoUsuarioForm').reset();
    atualizarRanking();
});

document.getElementById('comprovanteForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const arquivo = document.getElementById('comprovanteArquivo').files[0];
    if (!arquivo || !['.jpg', '.jpeg', '.png', '.pdf'].includes(arquivo.name.substring(arquivo.name.lastIndexOf('.')).toLowerCase())) return;
    comprovantes.push({
        id: comprovantes.length + 1,
        username: usuarioLogado.username,
        nome: usuarioLogado.nome,
        data: new Date().toLocaleString('pt-BR'),
        arquivo: arquivo.name,
        verificado: false
    });
    salvarDados();
    document.getElementById('comprovanteForm').reset();
    document.getElementById('comprovanteSuccess').style.display = 'block';
    setTimeout(() => document.getElementById('comprovanteSuccess').style.display = 'none', 3000);
    atualizarInvestimentos();
});

function atualizarInvestimentos() {
    const body = document.getElementById('investimentosBody');
    body.innerHTML = comprovantes.length ? comprovantes.map(c => `
        <tr>
            <td>${sanitizeInput(c.nome)}</td>
            <td>${sanitizeInput(c.data)}</td>
            <td>${c.verificado ? '<span class="badge bg-success">Verificado</span>' : '<span class="badge bg-warning">Pendente</span>'}</td>
            <td><button class="btn btn-primary btn-sm" onclick="visualizarComprovante(${c.id})">Visualizar</button></td>
        </tr>
    `).join('') : '<tr><td colspan="4" class="text-center">Nenhum comprovante</td></tr>';
}

function visualizarComprovante(id) {
    const c = comprovantes.find(c => c.id === id);
    document.getElementById('comprovanteModalLabel').textContent = `Comprovante de ${sanitizeInput(c.nome)}`;
    document.getElementById('comprovanteInfo').innerHTML = `
        <p><strong>Usuário:</strong> ${sanitizeInput(c.nome)}</p>
        <p><strong>Data:</strong> ${sanitizeInput(c.data)}</p>
        <p><strong>Arquivo:</strong> ${sanitizeInput(c.arquivo)}</p>
    `;
    document.getElementById('comprovanteVisualizacao').innerHTML = `<p>Visualização: ${sanitizeInput(c.arquivo)} (Simulação)</p>`;
    document.getElementById('verificarComprovanteBtn').disabled = c.verificado;
    document.getElementById('verificarComprovanteBtn').onclick = () => {
        c.verificado = true;
        salvarDados();
        atualizarInvestimentos();
        bootstrap.Modal.getInstance(document.getElementById('comprovanteModal')).hide();
        document.getElementById('sucessoTexto').textContent = 'Comprovante verificado!';
        new bootstrap.Modal(document.getElementById('sucessoModal')).show();
    };
    new bootstrap.Modal(document.getElementById('comprovanteModal')).show();
}

function sanitizeInput(input) {
    const div = document.createElement('div');
    div.textContent = input;
    return div.innerHTML.replace(/<[^>]+>/g, '');
}

function configurarFeed() {
    console.log('1. Iniciando configurarFeed');

    const feedForm = document.getElementById('feedForm');
    const feedFormContainer = document.getElementById('feedFormContainer');
    const feedMessage = document.getElementById('feedMessage');

    if (!feedForm || !feedFormContainer || !feedMessage) {
        console.error('Erro: Elementos feedForm, feedFormContainer ou feedMessage não encontrados.');
        return;
    }

    feedMessage.disabled = false;
    feedMessage.readOnly = false;
    feedMessage.style.pointerEvents = 'auto';
    console.log('2. Textarea configurado para ser interativo.');

    feedFormContainer.classList.toggle('hidden', !usuarioLogado.isAdmin);
    console.log(`3. Formulário de feed ${usuarioLogado.isAdmin ? 'exibido' : 'oculto'} para ${usuarioLogado.username}.`);

    feedForm.onsubmit = (e) => {
        e.preventDefault();
        console.log('4. Submissão do formulário iniciada');

        const mensagem = sanitizeInput(feedMessage.value.trim());
        const successMessage = document.getElementById('feedSuccess');
        const errorMessage = document.getElementById('feedError');

        if (!successMessage || !errorMessage) {
            console.error('Erro: feedSuccess ou feedError não encontrados.');
            return;
        }

        if (!mensagem) {
            console.log('Erro: Mensagem vazia.');
            errorMessage.textContent = 'Por favor, escreva uma mensagem.';
            errorMessage.style.display = 'block';
            setTimeout(() => errorMessage.style.display = 'none', 3000);
            return;
        }

        if (!usuarioLogado.isAdmin) {
            console.error('Erro: Tentativa de postagem por não-admin.');
            errorMessage.textContent = 'Apenas administradores podem postar.';
            errorMessage.style.display = 'block';
            setTimeout(() => errorMessage.style.display = 'none', 3000);
            return;
        }

        feeds.unshift({
            id: feeds.length + 1,
            autor: usuarioLogado.nome,
            mensagem,
            data: new Date().toLocaleString('pt-BR'),
            curtidas: [],
            comentarios: []
        });

        console.log('5. Feed adicionado:', feeds[0]);
        salvarDados();
        feedForm.reset();
        successMessage.style.display = 'block';
        setTimeout(() => successMessage.style.display = 'none', 3000);
        atualizarFeed();
    };

    atualizarFeed();
}

function atualizarFeed() {
    const container = document.getElementById('feedContainer');
    if (!container) {
        console.error('Erro: feedContainer não encontrado.');
        return;
    }

    console.log('Atualizando feed. Total de feeds:', feeds.length);

    container.innerHTML = feeds.length ? feeds.map(f => `
        <div class="feed-post">
            <div class="feed-post-header">
                <div>
                    <h5>${sanitizeInput(f.autor)}</h5>
                    <small>${sanitizeInput(f.data)}</small>
                </div>
                ${f.autor === usuarioLogado.nome || usuarioLogado.isAdmin ? `
                    <div class="feed-post-menu">
                        <button class="feed-post-menu-btn" onclick="toggleMenu(${f.id})"><i class="fas fa-ellipsis-v"></i></button>
                        <div class="feed-post-menu-content" id="menu-${f.id}">
                            <button class="edit" onclick="mostrarEditarFeed(${f.id})">Editar</button>
                            <button onclick="excluirFeed(${f.id})">Excluir</button>
                        </div>
                    </div>
                ` : ''}
            </div>
            <div class="feed-post-body">
                <p>${sanitizeInput(f.mensagem)}</p>
            </div>
            <div class="edit-form hidden" id="edit-feed-form-${f.id}">
                <form onsubmit="editarFeed(event, ${f.id})">
                    <div class="mb-3">
                        <textarea class="form-control" placeholder="Edite seu recado" required>${sanitizeInput(f.mensagem)}</textarea>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Salvar</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelarEdicaoFeed(${f.id})">Cancelar</button>
                    </div>
                </form>
            </div>
            <div class="feed-actions">
                <button class="feed-action-btn ${f.curtidas.includes(usuarioLogado.username) ? 'liked' : ''}" onclick="curtirFeed(${f.id})">
                    <i class="fas fa-heart"></i> <span>${f.curtidas.length}</span>
                </button>
            </div>
            <div class="comment-section" id="comment-section-${f.id}">
                <form class="comment-form" id="comment-form-${f.id}" onsubmit="comentarFeed(event, ${f.id})">
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control" placeholder="Escreva um comentário" required>
                        <button type="submit" class="btn btn-primary">Comentar</button>
                    </div>
                </form>
                <div class="comments">
                    ${f.comentarios.map((c, i) => `
                        <div class="comment">
                            <div class="comment-header">
                                <div>
                                    <h6>${sanitizeInput(c.autor)}</h6>
                                    <small>${sanitizeInput(c.data)}</small>
                                </div>
                                ${c.autor === usuarioLogado.nome || usuarioLogado.isAdmin ? `
                                    <div class="comment-menu">
                                        <button class="feed-post-menu-btn" onclick="toggleCommentMenu(${f.id}, ${i})"><i class="fas fa-ellipsis-v"></i></button>
                                        <div class="comment-menu-content" id="comment-menu-${f.id}-${i}">
                                            ${c.autor === usuarioLogado.nome ? `<button class="edit" onclick="mostrarEditarComentario(${f.id}, ${i})">Editar</button>` : ''}
                                            <button onclick="excluirComentario(${f.id}, ${i})">Excluir</button>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="comment-body">
                                <p>${sanitizeInput(c.mensagem)}</p>
                            </div>
                            <div class="edit-form hidden" id="edit-comment-form-${f.id}-${i}">
                                <form onsubmit="editarComentario(event, ${f.id}, ${i})">
                                    <div class="mb-3">
                                        <input type="text" class="form-control" value="${sanitizeInput(c.mensagem)}" required>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">Salvar</button>
                                        <button type="button" class="btn btn-secondary" onclick="cancelarEdicaoComentario(${f.id}, ${i})">Cancelar</button>
                                    </div>
                                </form>
                            </div>
                            <div class="comment-actions">
                                <button class="feed-action-btn ${c.curtidas.includes(usuarioLogado.username) ? 'liked' : ''}" onclick="curtirComentario(${f.id}, ${i})">
                                    <i class="fas fa-heart"></i> <span>${c.curtidas.length}</span>
                                </button>
                                <button class="btn-reply" onclick="mostrarReplyForm(${f.id}, ${i})">Responder</button>
                            </div>
                            <form class="reply-form" id="reply-form-${f.id}-${i}" onsubmit="responderComentario(event, ${f.id}, ${i})">
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" placeholder="Escreva uma resposta" required>
                                    <button type="submit" class="btn btn-primary">Responder</button>
                                </div>
                            </form>
                            <div class="replies">
                                ${c.respostas.map(r => `
                                    <div class="comment">
                                        <div class="comment-header">
                                            <h6>${sanitizeInput(r.autor)}</h6>
                                            <small>${sanitizeInput(r.data)}</small>
                                        </div>
                                        <div class="comment-body">
                                            <p>${sanitizeInput(r.mensagem)}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `).join('') : '<p class="text-center">Nenhum recado no feed.</p>';
}

function toggleMenu(feedId) {
    const menu = document.getElementById(`menu-${feedId}`);
    menu.classList.toggle('show');
}

function toggleCommentMenu(feedId, commentIndex) {
    const menu = document.getElementById(`comment-menu-${feedId}-${commentIndex}`);
    menu.classList.toggle('show');
}

function mostrarEditarFeed(feedId) {
    const form = document.getElementById(`edit-feed-form-${feedId}`);
    form.classList.remove('hidden');
    document.getElementById(`menu-${feedId}`).classList.remove('show');
}

function editarFeed(event, feedId) {
    event.preventDefault();
    const form = event.target;
    const mensagem = sanitizeInput(form.querySelector('textarea').value.trim());
    if (!mensagem) return;
    const feed = feeds.find(f => f.id === feedId);
    feed.mensagem = mensagem;
    salvarDados();
    form.parentElement.classList.add('hidden');
    atualizarFeed();
}

function cancelarEdicaoFeed(feedId) {
    document.getElementById(`edit-feed-form-${feedId}`).classList.add('hidden');
}

function excluirFeed(feedId) {
    feeds = feeds.filter(f => f.id !== feedId);
    salvarDados();
    atualizarFeed();
}

function curtirFeed(feedId) {
    console.log(`Tentando curtir feed ${feedId} por ${usuarioLogado.username}`);
    const feed = feeds.find(f => f.id === feedId);
    if (!feed) {
        console.error(`Feed ${feedId} não encontrado.`);
        return;
    }

    const username = usuarioLogado.username;
    if (feed.curtidas.includes(username)) {
        feed.curtidas = feed.curtidas.filter(u => u !== username);
        console.log(`Curtida removida do feed ${feedId}`);
    } else {
        feed.curtidas.push(username);
        console.log(`Curtida adicionada ao feed ${feedId}`);
    }
    salvarDados();
    atualizarFeed();
}

function toggleCommentForm(feedId) {
    // Formulário de comentário sempre visível, função mantida para compatibilidade
    console.log(`Formulário de comentário para feed ${feedId} já está visível`);
}

function comentarFeed(event, feedId) {
    event.preventDefault();
    console.log(`Tentando comentar no feed ${feedId} por ${usuarioLogado.username}`);
    const form = event.target;
    const mensagem = sanitizeInput(form.querySelector('input').value.trim());
    if (!mensagem) {
        console.log('Erro: Comentário vazio.');
        return;
    }

    const feed = feeds.find(f => f.id === feedId);
    if (!feed) {
        console.error(`Feed ${feedId} não encontrado.`);
        return;
    }

    feed.comentarios.push({
        autor: usuarioLogado.nome,
        mensagem,
        data: new Date().toLocaleString('pt-BR'),
        curtidas: [],
        respostas: []
    });

    console.log(`Comentário adicionado ao feed ${feedId}`);
    salvarDados();
    form.reset();
    atualizarFeed();
}

function mostrarEditarComentario(feedId, commentIndex) {
    const form = document.getElementById(`edit-comment-form-${feedId}-${commentIndex}`);
    form.classList.remove('hidden');
    document.getElementById(`comment-menu-${feedId}-${commentIndex}`).classList.remove('show');
}

function editarComentario(event, feedId, commentIndex) {
    event.preventDefault();
    const form = event.target;
    const mensagem = sanitizeInput(form.querySelector('input').value.trim());
    if (!mensagem) return;
    const feed = feeds.find(f => f.id === feedId);
    feed.comentarios[commentIndex].mensagem = mensagem;
    salvarDados();
    form.parentElement.classList.add('hidden');
    atualizarFeed();
}

function cancelarEdicaoComentario(feedId, commentIndex) {
    document.getElementById(`edit-comment-form-${feedId}-${commentIndex}`).classList.add('hidden');
}

function excluirComentario(feedId, commentIndex) {
    const feed = feeds.find(f => f.id === feedId);
    feed.comentarios.splice(commentIndex, 1);
    salvarDados();
    atualizarFeed();
}

function curtirComentario(feedId, commentIndex) {
    console.log(`Tentando curtir comentário ${commentIndex} do feed ${feedId} por ${usuarioLogado.username}`);
    const feed = feeds.find(f => f.id === feedId);
    if (!feed || !feed.comentarios[commentIndex]) {
        console.error(`Feed ${feedId} ou comentário ${commentIndex} não encontrado.`);
        return;
    }

    const comentario = feed.comentarios[commentIndex];
    const username = usuarioLogado.username;

    if (comentario.curtidas.includes(username)) {
        comentario.curtidas = comentario.curtidas.filter(u => u !== username);
        console.log(`Curtida removida do comentário ${commentIndex} do feed ${feedId}`);
    } else {
        comentario.curtidas.push(username);
        console.log(`Curtida adicionada ao comentário ${commentIndex} do feed ${feedId}`);
    }
    salvarDados();
    atualizarFeed();
}

function mostrarReplyForm(feedId, commentIndex) {
    // Formulário de resposta sempre visível, função mantida para compatibilidade
    console.log(`Formulário de resposta para comentário ${commentIndex} do feed ${feedId} já está visível`);
}

function responderComentario(event, feedId, commentIndex) {
    event.preventDefault();
    console.log(`Tentando responder comentário ${commentIndex} do feed ${feedId} por ${usuarioLogado.username}`);
    const form = event.target;
    const mensagem = sanitizeInput(form.querySelector('input').value.trim());
    if (!mensagem) {
        console.log('Erro: Resposta vazia.');
        return;
    }

    const feed = feeds.find(f => f.id === feedId);
    if (!feed || !feed.comentarios[commentIndex]) {
        console.error(`Feed ${feedId} ou comentário ${commentIndex} não encontrado.`);
        return;
    }

    feed.comentarios[commentIndex].respostas.push({
        autor: usuarioLogado.nome,
        mensagem,
        data: new Date().toLocaleString('pt-BR')
    });

    console.log(`Resposta adicionada ao comentário ${commentIndex} do feed ${feedId}`);
    salvarDados();
    form.reset();
    atualizarFeed();
}

function abrirModalPontuacao(username) {
    const usuario = usuarios.find(u => u.username === username);
    document.getElementById('adicionarPontuacaoModalLabel').textContent = `Adicionar Pontuação para ${sanitizeInput(usuario.nome)}`;
    const modal = new bootstrap.Modal(document.getElementById('adicionarPontuacaoModal'));
    const form = document.getElementById('adicionarPontuacaoForm');
    const pontosInput = document.getElementById('pontosInput');
    const pontosError = document.getElementById('pontosError');

    pontosInput.value = '';
    pontosError.style.display = 'none';

    form.onsubmit = (e) => {
        e.preventDefault();
        const pontos = parseInt(pontosInput.value.trim());
        if (isNaN(pontos) || pontos < 0) {
            pontosError.style.display = 'block';
            setTimeout(() => pontosError.style.display = 'none', 3000);
            return;
        }

        usuario.pontos += pontos;
        salvarDados();
        atualizarRanking();
        modal.hide();
        document.getElementById('sucessoTexto').textContent = `Pontuação de ${pontos} pontos adicionada para ${sanitizeInput(usuario.nome)}!`;
        new bootstrap.Modal(document.getElementById('sucessoModal')).show();
    };

    modal.show();
}
 </script>   
</body>
</html>
